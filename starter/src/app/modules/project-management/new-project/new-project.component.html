<div class="w-full p-4">
    <div class="space-y-2 mb-4">
        <div class="text-xl font-semibold leading-8 tracking-tight">
            Crea nuovo progetto
        </div>
        <div class="text-sm text-gray-600">
            Un progetto rappresenta un'iniziativa, attivit√† o area di lavoro personalizzata, con le proprie
            impostazioni, flussi di lavoro e partecipanti. Pu√≤ essere pubblico o privato, a seconda delle esigenze del
            tuo team.
        </div>
    </div>

    <!-- <form [formGroup]="form" class="space-y-4">
  
        <div class="gt-xs:flex-row flex flex-col">
            <mat-form-field
                [ngClass]="formFieldHelpers"
                class="gt-xs:pr-3 flex-auto"
            >
                <mat-label>Nome progetto</mat-label>
                <input matInput />
                <mat-icon
                    class="icon-size-5"
                    matSuffix
                    [svgIcon]="'heroicons_outline:folder'"
                ></mat-icon>
            </mat-form-field>
            <mat-form-field
                [ngClass]="formFieldHelpers"
                class="gt-xs:pl-3 flex-auto"
            >
                <mat-label>Descrizione</mat-label>
                <input matInput />
                <mat-icon
                    class="icon-size-5"
                    matSuffix
                    [svgIcon]="'heroicons_solid:document-text'"
                ></mat-icon>
            </mat-form-field>
        </div>
  
      <div *ngIf="isPublic" class="space-y-2">
        <mat-label>Persone da aggiungere</mat-label>
        <mat-chip-list #chipList>
          <mat-chip *ngFor="let person of form.get('people')?.value" (removed)="removePerson(person)">
            {{ person }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input
            placeholder="Aggiungi persona"
            [matChipInputFor]="chipList"
            [matChipInputSeparatorKeyCodes]="[13, 188]"
            (matChipInputTokenEnd)="addPerson($event.value)"
          />
        </mat-chip-list>
      </div>
  
      <div class="flex justify-end pt-6 gap-2">
        <button mat-stroked-button (click)="close()">Annulla</button>
        <button mat-flat-button color="primary" (click)="save()" [disabled]="form.invalid">Crea</button>
      </div>
    </form> -->
    <form [formGroup]="form" class="space-y-4">

        <div class="gt-xs:flex-row flex flex-col">
            <mat-form-field [ngClass]="formFieldHelpers" class="gt-xs:pr-3 flex-auto">
                <mat-label>Nome progetto</mat-label>
                <input matInput formControlName="name" />
                <mat-icon class="icon-size-5" matSuffix [svgIcon]="'heroicons_outline:folder'"></mat-icon>
            </mat-form-field>

            <mat-form-field [ngClass]="formFieldHelpers" class="gt-xs:pl-3 flex-auto">
                <mat-label>Descrizione</mat-label>
                <input matInput formControlName="description" />
                <mat-icon class="icon-size-5" matSuffix [svgIcon]="'heroicons_solid:document-text'"></mat-icon>
            </mat-form-field>
        </div>

        <!-- üîÑ Switch pubblico/privato -->
        <!-- <mat-slide-toggle formControlName="isPublic" color="primary">
           
        </mat-slide-toggle> -->

        <!-- Toggle personalizzato cliccando sull'icona o il testo -->
        <div class="flex items-center gap-2 cursor-pointer select-none" (click)="toggleVisibility()">
            <mat-icon
                [svgIcon]="form.get('isPublic')?.value ? 'heroicons_outline:lock-open' : 'heroicons_outline:lock-closed'"
                class="icon-size-4" [ngClass]="{
                    'text-primary': form.get('isPublic')?.value,
                    'text-gray-500': !form.get('isPublic')?.value
                }"></mat-icon>

            <span class="text-sm" [ngClass]="{
                    'text-primary': form.get('isPublic')?.value,
                    'text-gray-500': !form.get('isPublic')?.value
                }">
                {{ form.get('isPublic')?.value ? 'Progetto pubblico' : 'Progetto privato' }}
            </span>
        </div>



        <!-- üë• Persone da aggiungere -->

        <!-- üë• Persone da aggiungere -->
        <!-- üë• Persone da aggiungere -->
        <div *ngIf="isPublic" class="mt-4 space-y-3">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600 font-medium">
                    Condividi solo con:
                </div>

                <!-- Avatar a destra -->
                <div *ngIf="form.get('people')?.value?.length > 0" class="flex items-center -space-x-3">
                    <ng-container *ngFor="let person of displayedAvatars(); let i = index">
                        <div class="relative group">
                            <div
                                class="w-8 h-8 rounded-full border-2 border-white text-xs font-semibold text-white flex items-center justify-center"
                                [ngStyle]="{ 'background-color': getColorFor(person) }"
                                [matTooltip]="person">
                                {{ getInitials(person) }}
                            </div>
                        
                            <!-- Bottone "x" visibile al hover -->
                            <button type="button"
                                class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white text-gray-500 hover:text-red-600 shadow-md text-[10px] font-bold hidden group-hover:flex items-center justify-center"
                                (click)="removePerson(person)"
                                title="Rimuovi">
                                √ó
                            </button>
                        </div>
                        
                    </ng-container>

                    <!-- +N -->
                    <div *ngIf="form.get('people')?.value.length > 5"
                        class="w-8 h-8 rounded-full bg-gray-100 border-2 border-white text-[11px] font-medium text-gray-700 flex items-center justify-center">
                        +{{ form.get('people')?.value.length - 5 }}
                    </div>
                </div>
            </div>

            <!-- Campo autocomplete chip, senza mostrare i chip selezionati -->
            <mat-form-field class="w-full" appearance="outline">
                <input placeholder="Aggiungi persona" [formControl]="peopleCtrl" [matAutocomplete]="auto" matInput
                    (keyup.enter)="addPerson(peopleCtrl.value)" />
                <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addPerson($event.option.value)">
                    <mat-option *ngFor="let person of filteredPeople$ | async" [value]="person">
                        {{ person }}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>
            
        </div>




        <div class="flex justify-end pt-6 gap-2">
            <button mat-stroked-button (click)="close()">Annulla</button>
            <button mat-flat-button color="primary" (click)="save()" [disabled]="form.invalid">Crea</button>
        </div>
    </form>

</div>