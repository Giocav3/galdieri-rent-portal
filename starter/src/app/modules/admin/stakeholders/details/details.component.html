<div class="flex w-full flex-col">
    <div class="flex w-full flex-col">
        <div class="flex w-full flex-col">
            <!-- View mode -->
            @if (!editMode) {
                <!-- Header -->
                <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
                    <!-- Background -->
                    <img class="absolute inset-0 h-full w-full object-cover" [src]="contact?.background ? contact?.background : 'images/logo/auto.jpeg'" />
                    
                    <!-- Close button -->
                    <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
                        <a mat-icon-button [matTooltip]="'Close'" [routerLink]="['../']">
                            <mat-icon class="text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                        </a>
                    </div>
                </div>
          
                <!-- Stakeholder -->
                <div class="relative flex flex-auto flex-col items-center p-6 pt-0 sm:p-12 sm:pt-0">
                    <div class="w-full max-w-3xl">
                        <!-- Avatar and actions -->
                        <div class="-mt-16 flex flex-auto items-end">
                            <!-- Avatar -->
                            <div class="ring-bg-card flex h-32 w-32 items-center justify-center overflow-hidden rounded-full ring-4">
                                <div class="flex h-full w-full items-center justify-center overflow-hidden rounded bg-gray-200 text-8xl font-bold uppercase leading-none text-gray-600 dark:bg-gray-700 dark:text-gray-200">
                                    {{ contact?.companyData?.companyName?.charAt(0) || '' }}
                                </div>
                            </div>
                            <!-- Actions -->
                            <div class="mb-1 ml-auto flex items-center">
                                <button mat-stroked-button (click)="toggleEditMode(true)">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:pencil-square'"></mat-icon>
                                    <span class="ml-2">Edit</span>
                                </button>
                            </div>
                        </div>
          
                        <!-- Name -->
                        <div class="mt-3 truncate text-4xl font-bold">
                            {{ contact?.companyData?.companyName }}
                        </div>
          
                        <!-- Sezione 1: Informazioni Aziendali -->
                        <div class="mt-4 border-t pt-6">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold">Informazioni Aziendali</h3>
                                <button mat-button (click)="toggleSection('company')" class="text-primary-500">
                                    {{ expandedSections.company ? 'Mostra di più' : 'Mostra di meno' }}
                                    <mat-icon [svgIcon]="expandedSections.company ? 'heroicons_outline:plus' : 'heroicons_outline:minus'"></mat-icon>
                                </button>
                            </div>
                            
                            <div class="overflow-hidden">
                                <div @expandCollapse class="animated-box">
                                    <div class="flex flex-col space-y-8 pt-6">
                                        @if (expandedSections.company) {
                                            <!-- Tutti i campi aziendali -->
                                            <div class="flex sm:items-center">
                                                <mat-icon [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                                                <div class="ml-6 leading-6">
                                                    {{ contact?.companyData?.companyName }}
                                                </div>
                                            </div>
                                            <!-- Altri campi aziendali... -->
                                        } @else {
                                            <!-- Solo 3 campi principali -->
                                            <div class="flex sm:items-center">
                                                <mat-icon [svgIcon]="'heroicons_outline:building-office-2'"></mat-icon>
                                                <div class="ml-6 leading-6">
                                                    {{ contact?.companyData?.companyName }}
                                                </div>
                                            </div>
                                            @if (contact?.companyData?.vatNumber) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.companyData.vatNumber }}
                                                    </div>
                                                </div>
                                            }
                                            @if (contact?.type) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="getStakeholderConfig(contact?.type).icon"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.type }}
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
          
                        <!-- Sezione 2: Informazioni Anagrafiche -->
                        <div class="mt-4 border-t pt-6">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-semibold">Informazioni Anagrafiche</h3>
                                <button mat-button (click)="toggleSection('personal')" class="text-primary-500">
                                    {{ expandedSections.personal ? 'Mostra di più' : 'Mostra di meno' }}
                                    <mat-icon [svgIcon]="expandedSections.personal ? 'heroicons_outline:plus' : 'heroicons_outline:minus'"></mat-icon>
                                </button>
                            </div>
                            
                            <div class="overflow-hidden">
                                <div @expandCollapse class="animated-box">
                                    <div class="flex flex-col space-y-8 pt-6">
                                        @if (expandedSections.personal) {
                                            <!-- Tutti i campi anagrafici -->
                                            @if (contact?.personalData?.name || contact?.personalData?.surname) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="'heroicons_outline:user'"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.personalData.name }} {{ contact?.personalData.surname }}
                                                    </div>
                                                </div>
                                            }
                                            <!-- Altri campi anagrafici... -->
                                        } @else {
                                            <!-- Solo 3 campi principali -->
                                            @if (contact?.personalData?.name || contact?.personalData?.surname) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="'heroicons_outline:user'"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.personalData.name }} {{ contact?.personalData.surname }}
                                                    </div>
                                                </div>
                                            }
                                            @if (contact?.personalData?.email) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.personalData.email }}
                                                    </div>
                                                </div>
                                            }
                                            @if (contact?.personalData?.phone) {
                                                <div class="flex sm:items-center">
                                                    <mat-icon [svgIcon]="'heroicons_outline:phone'"></mat-icon>
                                                    <div class="ml-6 leading-6">
                                                        {{ contact?.personalData.phone }}
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <!-- Sezione 4: Stakeholder Correlati -->
@if (relatedStakeholders?.length > 0) {
    <div class="mt-4 border-t pt-6">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-semibold">Stakeholder Correlati</h3>
            <button mat-button (click)="toggleSection('related')" class="text-primary-500">
                {{ expandedSections.related ? 'Mostra di meno' : 'Mostra di più' }}
                <mat-icon [svgIcon]="expandedSections.related ? 'heroicons_outline:minus' : 'heroicons_outline:plus'"></mat-icon>
            </button>
        </div>
        
        <div class="overflow-hidden">
            <div @expandCollapse class="animated-box">
                <div class="flex flex-col space-y-8 pt-6">
                    @if (expandedSections.related) {
                        @for (stakeholder of relatedStakeholders; track trackByFn($index, stakeholder)) {
                            <div class="rounded-lg border bg-gray-50 p-6 dark:bg-gray-800">
                                <h4 class="mb-4 flex items-center text-lg font-medium">
                                    <mat-icon [svgIcon]="getStakeholderConfig(stakeholder.stakeholderType).icon" 
                                            [color]="getStakeholderConfig(stakeholder.stakeholderType).color"
                                            class="mr-2"></mat-icon>
                                    Informazioni {{ stakeholder.stakeholderType }}
                                </h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    @if (stakeholder.userDetails?.iban) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:currency-euro'"></mat-icon>
                                            <div class="ml-2 min-w-0 max-w-[200px]">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">IBAN</div>
                                                <div style="font-size:smaller">{{ stakeholder.userDetails.iban }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.paymentMethod) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:currency-euro'"></mat-icon>
                                            <div class="ml-2 min-w-0 max-w-[200px]">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Metodo di pagamento</div>
                                                <div>{{ stakeholder.userDetails.paymentMethod }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.clientCode) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:identification'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Codice Cliente</div>
                                                <div>{{ stakeholder.userDetails.clientCode }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.businessSector) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:briefcase'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Settore</div>
                                                <div>{{ stakeholder.userDetails.businessSector }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.clientType) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:user-circle'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Tipologia Cliente</div>
                                                <div>{{ stakeholder.userDetails.clientType }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.origin) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:globe-alt'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Origine</div>
                                                <div>{{ stakeholder.userDetails.origin }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.agreement) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Accordo</div>
                                                <div>{{ stakeholder.userDetails.agreement }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.associatedConsultant) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:users'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Consulente Associato</div>
                                                <div>{{ stakeholder.userDetails.associatedConsultant }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (stakeholder.userDetails?.sdiCode) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:cube'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Codice SDI</div>
                                                <div>{{ stakeholder.userDetails.sdiCode }}</div>
                                            </div>
                                        </div>
                                    }

                                    @if (stakeholder.userDetails?.reference) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:arrow-top-right-on-square'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Referente</div>
                                                <div>{{ stakeholder.userDetails.reference }}</div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    } @else {
                        @if (relatedStakeholders[0]) {
                            <div class="rounded-lg border bg-gray-50 p-6 dark:bg-gray-800">
                                <h4 class="mb-4 flex items-center text-lg font-medium">
                                    <mat-icon [svgIcon]="getStakeholderConfig(relatedStakeholders[0].stakeholderType).icon" 
                                            [color]="getStakeholderConfig(relatedStakeholders[0].stakeholderType).color"
                                            class="mr-2"></mat-icon>
                                    Informazioni {{ relatedStakeholders[0].stakeholderType }}
                                </h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    @if (relatedStakeholders[0].userDetails?.iban) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:currency-euro'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">IBAN</div>
                                                <div style="font-size:smaller">{{ relatedStakeholders[0].userDetails.iban }}</div>
                                            </div>
                                        </div>
                                    }
                                    @if (relatedStakeholders[0].userDetails?.businessSector) {
                                        <div class="flex items-center">
                                            <mat-icon [svgIcon]="'heroicons_outline:briefcase'"></mat-icon>
                                            <div class="ml-2">
                                                <div class="text-sm text-gray-500 dark:text-gray-400">Settore</div>
                                                <div>{{ relatedStakeholders[0].userDetails.businessSector }}</div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
}
                    </div>
                </div>
            }
          
  
    <!-- Edit mode -->
    @if (editMode) {
        <!-- Header -->
        <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
            <!-- Background -->
            <img class="absolute inset-0 h-full w-full object-cover" [src]="'images/logo/auto.jpeg'" />
            
            <!-- Close button -->
            <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
                <a mat-icon-button [matTooltip]="'Close'" [routerLink]="['../']">
                    <mat-icon class="text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
                </a>
            </div>
        </div>
  
        <!-- Contact form -->
        <div class="relative flex flex-auto flex-col items-center px-6 sm:px-12">
            <div class="w-full max-w-3xl">
                
                    <!-- Avatar -->
                    <div class="-mt-16 flex flex-auto items-end">
                        <div class="ring-bg-card relative flex h-32 w-32 items-center justify-center overflow-hidden rounded-full ring-4">
                            <!-- Upload / Remove avatar -->
                            <div class="absolute inset-0 z-10 bg-black bg-opacity-50"></div>
                            <div class="absolute inset-0 z-20 flex items-center justify-center">
                                <div>
                                    <input
                                        id="avatar-file-input"
                                        class="pointer-events-none invisible absolute h-0 w-0 opacity-0"
                                        type="file"
                                        [multiple]="false"
                                        [accept]="'image/jpeg, image/png'"
                                        (change)="uploadAvatar(avatarFileInput.files)"
                                        #avatarFileInput
                                    />
                                    <label
                                        class="flex h-10 w-10 cursor-pointer items-center justify-center rounded-full hover:bg-hover"
                                        for="avatar-file-input"
                                        matRipple
                                    >
                                        <mat-icon
                                            class="text-white"
                                            [svgIcon]="'heroicons_outline:camera'"
                                        ></mat-icon>
                                    </label>
                                </div>
                                <div>
                                    <button mat-icon-button (click)="removeAvatar()">
                                        <mat-icon
                                            class="text-white"
                                            [svgIcon]="'heroicons_outline:trash'"
                                        ></mat-icon>
                                    </button>
                                </div>
                            </div>
                            <!-- Image/Letter -->
                            <div class="flex h-full w-full items-center justify-center overflow-hidden rounded bg-gray-200 text-8xl font-bold uppercase leading-none text-gray-600 dark:bg-gray-700 dark:text-gray-200">
                                {{ contact?.companyData.companyName.charAt(0) }}
                            </div>
                        </div>
                    </div>
  
                    <!-- Sezione 1: Informazioni Aziendali -->
                    <form [formGroup]="companyForm">
                        <div class="mt-4 flex flex-col space-y-8 border-t pt-6">
                        <h3 class="text-xl font-semibold">Informazioni Aziendali</h3>
                        
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <!-- Company Name -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Ragione Sociale</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:building-office'"></mat-icon>
                            <input matInput [formControlName]="'companyName'" [placeholder]="'Ragione Sociale'">
                            </mat-form-field>
    
                            <!-- VAT Number -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Partita IVA</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                            <input matInput [formControlName]="'vatNumber'" [placeholder]="'Partita IVA'">
                            </mat-form-field>
    
                            <!-- Company Phone -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Telefono</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:phone'"></mat-icon>
                            <input matInput [formControlName]="'phone'" [placeholder]="'Telefono'">
                            </mat-form-field>
    
                            <!-- Company Email -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Email</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                            <input matInput type="email" [formControlName]="'email'" [placeholder]="'Email'">
                            </mat-form-field>
    
                            <!-- PEC -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>PEC</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                            <input matInput type="email" [formControlName]="'pec'" [placeholder]="'PEC'">
                            </mat-form-field>
    
                            <!-- SDI Code -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Codice SDI</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:cube'"></mat-icon>
                            <input matInput [formControlName]="'sdiCode'" [placeholder]="'Codice SDI'">
                            </mat-form-field>
    
                            <!-- Address -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Indirizzo</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'address'" [placeholder]="'Indirizzo'">
                            </mat-form-field>
    
                            <!-- House Number -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Civico</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:hashtag'"></mat-icon>
                            <input matInput [formControlName]="'houseNumber'" [placeholder]="'Civico'">
                            </mat-form-field>
    
                            <!-- CAP -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>CAP</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'cap'" [placeholder]="'CAP'">
                            </mat-form-field>
    
                            <!-- Common -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Comune</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'common'" [placeholder]="'Comune'">
                            </mat-form-field>
    
                            <!-- Province -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Provincia</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map'"></mat-icon>
                            <input matInput [formControlName]="'province'" [placeholder]="'Provincia'">
                            </mat-form-field>
    
                            <!-- Region -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Regione</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:globe-alt'"></mat-icon>
                            <input matInput [formControlName]="'region'" [placeholder]="'Regione'">
                            </mat-form-field>
                        </div>
                        </div>
                    </form>
  
                    <!-- Sezione 2: Informazioni Anagrafiche -->
                    <form [formGroup]="personalForm">
                        <div class="mt-4 flex flex-col space-y-8 border-t pt-6">
                        <h3 class="text-xl font-semibold">Informazioni Anagrafiche</h3>
                        
                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <!-- Name -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Nome</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:user'"></mat-icon>
                            <input matInput [formControlName]="'name'" [placeholder]="'Nome'">
                            </mat-form-field>
    
                            <!-- Surname -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Cognome</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:user'"></mat-icon>
                            <input matInput [formControlName]="'surname'" [placeholder]="'Cognome'">
                            </mat-form-field>
    
                            <!-- Fiscal Code -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Codice Fiscale</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:identification'"></mat-icon>
                            <input matInput [formControlName]="'fiscalCode'" [placeholder]="'Codice Fiscale'">
                            </mat-form-field>
    
                            <!-- Gender -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Sesso</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:user-circle'"></mat-icon>
                            <mat-select [formControlName]="'gender'">
                                <mat-option value="M">Maschio</mat-option>
                                <mat-option value="F">Femmina</mat-option>
                                <mat-option value="O">Altro</mat-option>
                            </mat-select>
                            </mat-form-field>
    
                            <!-- Birthday -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Data di nascita</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                            <input matInput [formControlName]="'birthday'" [matDatepicker]="birthdayPicker">
                            <mat-datepicker-toggle matSuffix [for]="birthdayPicker"></mat-datepicker-toggle>
                            <mat-datepicker #birthdayPicker></mat-datepicker>
                            </mat-form-field>
    
                            <!-- Birth Place -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Luogo di nascita</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'birthPlace'" [placeholder]="'Luogo di nascita'">
                            </mat-form-field>
    
                            <!-- Birth County -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Provincia nascita</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'birthCounty'" [placeholder]="'Provincia nascita'">
                            </mat-form-field>
    
                            <!-- Title -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Titolo di studio</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:academic-cap'"></mat-icon>
                            <input matInput [formControlName]="'title'" [placeholder]="'Titolo di studio'">
                            </mat-form-field>
    
                            <!-- Personal Email -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Email</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                            <input matInput type="email" [formControlName]="'email'" [placeholder]="'Email'">
                            </mat-form-field>
    
                            <!-- Personal Phone -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Telefono</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:phone'"></mat-icon>
                            <input matInput [formControlName]="'phone'" [placeholder]="'Telefono'">
                            </mat-form-field>
    
                            <!-- Personal Address -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Indirizzo</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:home'"></mat-icon>
                            <input matInput [formControlName]="'address'" [placeholder]="'Indirizzo'">
                            </mat-form-field>
    
                            <!-- Personal House Number -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Civico</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:hashtag'"></mat-icon>
                            <input matInput [formControlName]="'houseNumber'" [placeholder]="'Civico'">
                            </mat-form-field>
    
                            <!-- Personal CAP -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>CAP</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'cap'" [placeholder]="'CAP'">
                            </mat-form-field>
    
                            <!-- Personal Common -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Comune</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map-pin'"></mat-icon>
                            <input matInput [formControlName]="'common'" [placeholder]="'Comune'">
                            </mat-form-field>
    
                            <!-- Personal Province -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Provincia</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:map'"></mat-icon>
                            <input matInput [formControlName]="'province'" [placeholder]="'Provincia'">
                            </mat-form-field>
    
                            <!-- Personal Region -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                            <mat-label>Regione</mat-label>
                            <mat-icon matPrefix [svgIcon]="'heroicons_outline:globe-alt'"></mat-icon>
                            <input matInput [formControlName]="'region'" [placeholder]="'Regione'">
                            </mat-form-field>
                        </div>
                        </div>
                    </form>
  
                    <!-- Sezione 3: Informazioni Aggiuntive -->
                    <form [formGroup]="userForm">
                        <div class="mt-4 flex flex-col space-y-8 border-t pt-6">
                            <h3 class="text-xl font-semibold">Informazioni Aggiuntive</h3>
                            
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                            <!-- IBAN -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                                <mat-label>IBAN</mat-label>
                                <mat-icon matPrefix [svgIcon]="'heroicons_outline:currency-euro'"></mat-icon>
                                <input matInput [formControlName]="'iban'" [placeholder]="'IBAN'">
                            </mat-form-field>

                            <!-- Business Sector -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                                <mat-label>Settore</mat-label>
                                <mat-icon matPrefix [svgIcon]="'heroicons_outline:briefcase'"></mat-icon>
                                <input matInput [formControlName]="'businessSector'" [placeholder]="'Settore'">
                            </mat-form-field>

                            <!-- From Date -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                                <mat-label>Da</mat-label>
                                <mat-icon matPrefix [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                                <input matInput [formControlName]="'from'" [matDatepicker]="fromPicker">
                                <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
                                <mat-datepicker #fromPicker></mat-datepicker>
                            </mat-form-field>

                            <!-- Convention -->
                            <mat-form-field [subscriptSizing]="'dynamic'">
                                <mat-label>Convenzione</mat-label>
                                <mat-icon matPrefix [svgIcon]="'heroicons_outline:pencil'"></mat-icon>
                                <input matInput [formControlName]="'convention'" [placeholder]="'Convenzione'">
                            </mat-form-field>
                            </div>
                        </div>
                    </form>
  
                    <!-- Actions -->
                    <div class="-mx-6 mt-10 flex items-center border-t bg-gray-50 py-4 pl-1 pr-4 dark:bg-transparent sm:-mx-12 sm:pl-7 sm:pr-12">
                        <!-- Delete -->
                        <button mat-button [color]="'warn'" [matTooltip]="'Delete'">
                            Delete
                        </button>
                        <!-- Cancel -->
                        <button class="ml-auto" mat-button [matTooltip]="'Cancel'" (click)="toggleEditMode(false)">
                            Cancel
                        </button>
                        <!-- Save -->
                        <button class="ml-2" mat-flat-button [color]="'primary'"  [matTooltip]="'Save'" (click)="savePersonalData()">
                            Save
                        </button>
                    </div>
            </div>
        </div>
    }
  </div>