<div class="absolute inset-0 flex min-w-0 flex-col overflow-hidden">
  <mat-drawer-container
      class="bg-card h-full flex-auto dark:bg-transparent"
      (backdropClick)="onBackdropClicked()"
  > 
      <!-- Drawer -->
      <mat-drawer
      class="w-full dark:bg-gray-900 md:w-160"
      [mode]="drawerMode"
      [opened]="false"
      [position]="'end'"
      [disableClose]="true"
      #matDrawer
    >
      <router-outlet></router-outlet>
    </mat-drawer>
  
  <mat-drawer-content class="flex flex-col bg-gray-50 dark:bg-gray-900">
    <div class="w-full max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <!-- Titolo -->
      <div class="mx-auto flex w-full max-w-screen-xl flex-col">
        <div
            class="my-8 flex min-w-0 flex-auto flex-col sm:my-12 sm:flex-row sm:items-center"
        >
            <!-- Avatar and name -->
            <div class="flex min-w-0 flex-auto items-center">
                
                <div class="flex min-w-0 flex-col">
                    <ng-container *transloco="let t">
                        <div
                            class="truncate text-2xl font-semibold leading-7 tracking-tight md:text-5xl md:leading-snug"
                        >
                            Stakeholders
                        </div>
                    </ng-container>
                    <div class="flex items-center">
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:user-group'"
                        ></mat-icon>
                        <div
                            class="text-secondary ml-1.5 truncate leading-6"
                        >
                          Monitora gli stakeholders, cerca e visualizza informazioni
                        </div>
                    </div>
                </div>
            </div>
            <!-- Actions - Hidden on mobile -->
            <div class="mt-6 flex items-center space-x-3 sm:ml-2 sm:mt-0 hidden sm:flex">
                <button mat-flat-button [color]="'primary'" (click)="openDialog()">
                    <mat-icon
                        class="icon-size-5"
                        [svgIcon]="'heroicons_solid:plus'"
                    ></mat-icon>
                    <span class="ml-2">Aggiungi Stakeholder</span>
                </button>
            </div>
        </div>
      </div>
  
      <!-- Filtri allineati -->
      <div class="grid w-full grid-cols-1 gap-y-2 sm:grid-cols-12 sm:gap-4 mb-2 items-end ">
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="col-span-12 sm:col-span-3">
          <mat-select [(ngModel)]="selectedStakeholderType" (selectionChange)="onTypeChange($event.value)">
              <mat-option value="Tutti">Tutti</mat-option>
              <mat-option *ngFor="let stakeholder of stakeholderTypes" [value]="stakeholder">
                  {{ stakeholder }}
              </mat-option>
          </mat-select>
      </mat-form-field>
  
      <!-- Ricerca (9/12) -->
      <mat-form-field appearance="outline" subscriptSizing="dynamic" class="col-span-12 sm:col-span-9">
          <mat-icon
              matPrefix
              class="icon-size-5"
              [svgIcon]="'heroicons_solid:magnifying-glass'"
          ></mat-icon>
          <input
              matInput
              placeholder="Cerca per denominazione o identificativo fiscale"
              [(ngModel)]="searchQuery"
              (ngModelChange)="onSearchChange()"
          />
      </mat-form-field>
      </div>
  
      <!-- Tabella -->
      <div *ngIf="filteredStakeholders.length > 0" class="bg-card rounded-2xl shadow overflow-hidden">
        <div class="p-6 border-b">
          <div class="text-lg font-medium tracking-tight">
            {{ selectedStakeholderType || 'Stakeholder filtrati' }}
          </div>
          <div class="text-secondary text-sm">Visualizza la lista dettagliata</div>
        </div>
  
        <div class="overflow-x-auto p-6">
          <table class="min-w-full bg-transparent" mat-table matSort [dataSource]="tableDataSource">
            <!-- Colonne -->
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Tipo</th>
              <td mat-cell *matCellDef="let stakeholder"> {{ stakeholder.stakeholder.type }} </td>
            </ng-container>
  
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Denominazione</th>
              <td mat-cell *matCellDef="let stakeholder">
                {{ stakeholder.stakeholder.companyName }}
              </td>
            </ng-container>
  
            <ng-container matColumnDef="taxIdentifier">
              <th mat-header-cell *matHeaderCellDef>Identificativo fiscale</th>
              <td mat-cell *matCellDef="let stakeholder">
                {{ stakeholder.stakeholder.taxIdentifier }}
              </td>
            </ng-container>
  
            <ng-container matColumnDef="matches">
              <th mat-header-cell *matHeaderCellDef>Tipologia</th>
              <td mat-cell *matCellDef="let stakeholder">
                <ng-container *ngFor="let match of stakeholder.matches">
                  <span class="inline-block rounded-full bg-blue-100 text-blue-800 px-2 py-1 text-xs font-semibold mr-1">
                    {{ match.stakeholderType }}
                  </span>
                </ng-container>
              </td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="tableDisplayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: tableDisplayedColumns"
              (click)="openStakeholderDetails(row)"
              [routerLink]="['./', row.stakeholder.id]"
              class="cursor-pointer hover:bg-gray-100 transition"
            ></tr>
          </table>
  
          <mat-paginator
            [length]="totalItems"
            [pageSize]="pageSize"
            [pageIndex]="currentPage"
            [pageSizeOptions]="[5, 10, 20]"
            (page)="onPageChange($event)"
            showFirstLastButtons
            class="flex justify-end"
          ></mat-paginator>
        </div>
      </div>
    </div>
    </mat-drawer-content>
  </mat-drawer-container>

  <!-- Floating Action Button for Mobile -->
  <button 
    mat-fab 
    [color]="'primary'" 
    (click)="openDialog()"
    class="fixed bottom-6 right-6 sm:hidden z-50"
    aria-label="Aggiungi Stakeholder"
  >
    <mat-icon [svgIcon]="'heroicons_solid:plus'"></mat-icon>
  </button>
</div>