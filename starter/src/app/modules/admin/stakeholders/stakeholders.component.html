<div class="flex flex-col w-full">
  <div class="w-full max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    
    <!-- Titolo -->
    <div class="mb-6">
      <h1 class="text-3xl font-semibold tracking-tight">Stakeholders</h1>
      <p class="text-secondary text-base tracking-tight">
        Monitora gli stakeholders, cerca e visualizza informazioni
      </p>
    </div>

    <!-- Filtri allineati -->
    <div class="grid w-full grid-cols-1 gap-4 sm:grid-cols-12 items-end mb-6">
      <!-- Tipo stakeholder (3/12) -->
      <mat-form-field appearance="fill" class="col-span-12 sm:col-span-3">
        <!-- <mat-label>Tipo stakeholder</mat-label> -->
        <mat-select [(ngModel)]="selectedStakeholderType" (selectionChange)="onTypeChange($event.value)">
          <mat-option value="Tutti">Tutti</mat-option>
          <mat-option *ngFor="let stakeholder of stakeholderTypes" [value]="stakeholder">
            {{ stakeholder }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Ricerca (9/12) -->
      <mat-form-field appearance="fill" class="col-span-12 sm:col-span-9">
        <!-- <mat-label>Ricerca</mat-label> -->
        <mat-icon
          matPrefix
          class="icon-size-5"
          [svgIcon]="'heroicons_solid:magnifying-glass'"
        ></mat-icon>
        <input
          matInput
          placeholder="Cerca per denominazione o identificativo fiscale"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
        />
      </mat-form-field>
    </div>

    <!-- Tabella -->
    <div *ngIf="filteredStakeholders.length > 0" class="bg-card rounded-2xl shadow overflow-hidden">
      <div class="p-6 border-b">
        <div class="text-lg font-medium tracking-tight">
          {{ selectedStakeholderType || 'Stakeholder filtrati' }}
        </div>
        <div class="text-secondary text-sm">Visualizza la lista dettagliata</div>
      </div>

      <div class="overflow-x-auto p-6">
        <table class="min-w-full bg-transparent" mat-table matSort [dataSource]="tableDataSource">
          <!-- Colonne -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Tipo</th>
            <td mat-cell *matCellDef="let stakeholder"> {{ stakeholder.stakeholder.type }} </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Denominazione</th>
            <td mat-cell *matCellDef="let stakeholder">
              {{ stakeholder.stakeholder.companyName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="taxIdentifier">
            <th mat-header-cell *matHeaderCellDef>Identificativo fiscale</th>
            <td mat-cell *matCellDef="let stakeholder">
              {{ stakeholder.stakeholder.taxIdentifier }}
            </td>
          </ng-container>

          <ng-container matColumnDef="matches">
            <th mat-header-cell *matHeaderCellDef>Tipologia</th>
            <td mat-cell *matCellDef="let stakeholder">
              <ng-container *ngFor="let match of stakeholder.matches">
                <span class="inline-block rounded-full bg-blue-100 text-blue-800 px-2 py-1 text-xs font-semibold mr-1">
                  {{ match.stakeholderType }}
                </span>
              </ng-container>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="tableDisplayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: tableDisplayedColumns"
            (click)="openStakeholderDetails(row)"
            class="cursor-pointer hover:bg-gray-100 transition"
          ></tr>
        </table>

        <mat-paginator
          [length]="totalItems"
          [pageSize]="pageSize"
          [pageIndex]="currentPage"
          [pageSizeOptions]="[5, 10, 20]"
          (page)="onPageChange($event)"
          showFirstLastButtons
        ></mat-paginator>
      </div>
    </div>
    <!-- Drawer Dettagli -->
    <div
    *ngIf="selectedStakeholder"
    class="fixed top-0 right-0 h-full w-full sm:w-[500px] z-50 bg-white shadow-lg transition-transform transform duration-300"
    [class.translate-x-full]="!showDetails"
    [class.translate-x-0]="showDetails"
    >
    <app-details
      [contact]="selectedStakeholder"
      (close)="closeDetails()"
    ></app-details>
    </div>

  </div>
</div>



